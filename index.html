<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>math.io</title>
  <style>
    :root {
      --bg: #0a0f1f;
      --card: #131b2d;
      --border: #1f2940;
      --accent: #4db5ff;
      --accent-hover: #72c9ff;
      --text: #e6ecff;
      --muted: #7a86a5;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg);
      font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: var(--text);
    }
    .wrap {
      width: min(700px, 92vw);
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 28px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.6);
    }
    h1 {
      margin: 0 0 8px;
      font-weight: 600;
      font-size: 26px;
      color: var(--accent);
    }
    p.hint {
      margin: 0 0 18px;
      color: var(--muted);
      font-size: 14px;
    }
    textarea {
      width: 100%;
      height: 120px;
      padding: 14px;
      font: 16px/1.45 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      border: 1px solid var(--border);
      border-radius: 12px;
      outline: none;
      resize: vertical;
      background: #0d1322;
      color: var(--text);
    }
    textarea:focus { border-color: var(--accent); }
    .actions {
      display: flex;
      gap: 10px;
      margin-top: 14px;
      flex-wrap: wrap;
    }
    button {
      appearance: none;
      border: none;
      padding: 10px 16px;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: 0.2s;
    }
    button.primary {
      background: var(--accent);
      color: #000;
    }
    button.primary:hover { background: var(--accent-hover); }
    button.secondary {
      background: transparent;
      border: 1px solid var(--accent);
      color: var(--accent);
    }
    button.secondary:hover {
      background: var(--accent);
      color: #000;
    }
    .output, .steps {
      margin-top: 18px;
      padding: 14px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #0d1322;
      font-size: 15px;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .steps h3 {
      margin: 0 0 8px;
      font-size: 16px;
      color: var(--accent);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }
    .step {
      padding: 8px 10px;
      border: 1px dashed var(--border);
      border-radius: 8px;
      margin: 6px 0;
      background: #131b2d;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size: 14px;
      color: var(--text);
    }
    .hidden { display: none; }
    .muted { color: var(--muted); font-size: 13px; }
    .coffee {
      position: fixed;
      bottom: 14px;
      right: 14px;
      opacity: 0.9;
    }
    .coffee img { width: 40px; height: 40px; }
  </style>
</head>
<body>

  <div class="wrap">
    <h1>math.io</h1>
    <p class="hint">Paste any math expression or equation (e.g. <code>(5^2 + 10)/3</code>, <code>sqrt(25)</code>, <code>2x + 4x = 18</code>).</p>

    <textarea id="problem" placeholder="Paste your math problem here..."></textarea>

    <div class="actions">
      <button class="primary" id="solveBtn">Solve</button>
      <button class="secondary" id="stepsBtn">Step-by-step</button>
    </div>

    <div class="output" id="answer">Answer will appear here.</div>
    
    <div class="steps hidden" id="stepsBox">
      <h3>
        Step-by-step 
        <span id="toggleArrow">▼</span>
      </h3>
      <div id="steps"></div>
    </div>
  </div>

  <!-- Buy Me a Coffee Icon -->
  <a class="coffee" href="https://www.buymeacoffee.com/YOURUSERNAME" target="_blank">
    <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me a Coffee">
  </a>

  <!-- math.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
  <!-- mathsteps -->
  <script src="https://unpkg.com/mathsteps/dist/mathsteps.min.js"></script>

  <script>
    const problemEl = document.getElementById("problem");
    const answerEl = document.getElementById("answer");
    const stepsBox = document.getElementById("stepsBox");
    const stepsEl = document.getElementById("steps");
    const stepsBtn = document.getElementById("stepsBtn");
    const toggleArrow = document.getElementById("toggleArrow");

    let stepsVisible = true;

    function solveExpression(expr) {
      try {
        const result = math.evaluate(expr);
        return "Answer: " + result;
      } catch (e) {
        return "Error: Invalid expression";
      }
    }

    function showSteps(expr) {
      stepsEl.innerHTML = "";
      stepsBox.classList.remove("hidden");

      let steps = [];
      try {
        if (expr.includes("=")) {
          steps = mathsteps.solveEquation(expr);
        } else {
          steps = mathsteps.simplifyExpression(expr);
        }
      } catch (e) {
        steps = [];
      }

      if (!steps || steps.length === 0) {
        stepsEl.innerHTML = "<div class='step'>No detailed steps available for this input.</div>";
        return;
      }

      steps.forEach((s, i) => {
        const div = document.createElement("div");
        div.className = "step";
        div.textContent = `${i+1}. ${s.oldExpression || s.beforeChange} → ${s.newExpression || s.afterChange}`;
        stepsEl.appendChild(div);
      });
    }

    document.getElementById("solveBtn").addEventListener("click", () => {
      const expr = problemEl.value.trim();
      answerEl.textContent = expr ? solveExpression(expr) : "Enter a problem first.";
    });

    stepsBtn.addEventListener("click", () => {
      const expr = problemEl.value.trim();
      if (!expr) {
        stepsBox.classList.remove("hidden");
        stepsEl.innerHTML = "<div class='step'>Enter a problem first.</div>";
        return;
      }
      showSteps(expr);
    });

    // Toggle collapsible panel
    stepsBox.querySelector("h3").addEventListener("click", () => {
      stepsVisible = !stepsVisible;
      stepsEl.style.display = stepsVisible ? "block" : "none";
      toggleArrow.textContent = stepsVisible ? "▼" : "▲";
    });
  </script>
</body>
</html>
